---
- name: Create a VM in OpenShift Virtualization
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create a RHEL VM in OpenShift
      redhat.openshift.k8s:
        definition:
          apiVersion: v1
          kind: Pod
          metadata:
            name: dante-testing
            labels:
              app: httpd
            namespace: dante-garro-dev
          spec:
            securityContext:
              runAsNonRoot: true
              seccompProfile:
                type: RuntimeDefault
            containers:
              - name: httpd
                image: 'image-registry.openshift-image-registry.svc:5000/openshift/httpd:latest'
                ports:
                  - containerPort: 8080
                securityContext:
                  allowPrivilegeEscalation: false
                  capabilities:
                    drop:
                      - ALL
